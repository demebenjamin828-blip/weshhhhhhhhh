<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Biblique</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<style>
:root{
  --primary:#27ae60;
  --primary-dark:#1e8449;
  --success:#2ecc71;
  --error:#e74c3c;
  --soft:#eafaf1;
  --text:#2c3e50;
}

body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#f3fbf6,#d4efdf);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.quiz-card{
  background:white;
  padding:40px;
  border-radius:20px;
  box-shadow:0 25px 60px rgba(0,0,0,0.12);
  width:90%;
  max-width:700px;
}

.step{display:none;}
.step.active{display:block;}

.q-block{
  margin-bottom:18px;
  padding:20px;
  border-radius:14px;
  border:1px solid #d4efdf;
}

input{
  width:100%;
  padding:14px;
  border-radius:10px;
  border:2px solid #e2e8f0;
}

.btn-nav{
  width:100%;
  padding:15px;
  border-radius:12px;
  font-weight:bold;
  cursor:pointer;
  border:none;
  background:var(--primary);
  color:white;
  margin-top:10px;
}

.option-btn{
  width:100%;
  padding:14px;
  margin-top:8px;
  border-radius:10px;
  border:2px solid #e2e8f0;
  background:#f8f9fa;
  cursor:pointer;
}

.option-btn.selected{
  background:var(--primary);
  color:white;
}

.progress-container{
  width:100%;
  height:14px;
  background:#d4efdf;
  border-radius:20px;
  overflow:hidden;
  margin-bottom:20px;
}

.progress-bar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#27ae60,#2ecc71);
}

/* états correction */
.is-correct{border-color:var(--success)!important;background:#f0fff4;}
.is-wrong{border-color:var(--error)!important;background:#fff5f5;}

.score-anim{
  font-size:52px;
  color:var(--success);
  text-align:center;
}
</style>
</head>

<body>
<div class="quiz-card">

<h2 style="text-align:center;color:var(--primary)">Quiz Biblique</h2>

<div class="progress-container">
<div class="progress-bar" id="progressBar"></div>
</div>

<form id="quizForm">

<!-- ETAPE 0 -->
<div class="step active" id="step0">
<div class="q-block">
<label>Prénom</label><input type="text" id="prenom"><br><br>
<label>Nom</label><input type="text" id="nom"><br><br>
<label>Email</label><input type="email" id="email"><br><br>
</div>
<button type="button" class="btn-nav" onclick="nextStep(0)">Commencer</button>
</div>

<!-- QUESTIONS -->
<div class="step" id="step1">
<div class="q-block"><label>1. Ville de naissance de Jésus ?</label><input id="q1"></div>
<div class="q-block"><label>2. Qui a renié Jésus ?</label><input id="q2"></div>

<button type="button" class="btn-nav" onclick="prevStep(1)">← Retour</button>
<button type="button" class="btn-nav" onclick="nextStep(1)">Suivant →</button>
</div>

<div class="step" id="step2">
<div class="q-block"><label>3. Dernier livre de la Bible ?</label><input id="q3"></div>
<div class="q-block"><label>4. Qui a baptisé Jésus ?</label><input id="q4"></div>

<button type="button" class="btn-nav" onclick="prevStep(2)">← Retour</button>
<button type="button" class="btn-nav" onclick="nextStep(2)">Suivant →</button>
</div>

<div class="step" id="step3">
<div class="q-block"><label>5. Nombre d'Évangiles ?</label><input id="q5"></div>
<div class="q-block"><label>6. Mer où Jésus a marché ?</label><input id="q6"></div>

<button type="button" class="btn-nav" onclick="prevStep(3)">← Retour</button>
<button type="button" class="btn-nav" onclick="nextStep(3)">Suivant →</button>
</div>

<div class="step" id="step4">
<div class="q-block"><label>7. Auteur principal des Épîtres ?</label><input id="q7"></div>
<div class="q-block"><label>8. Miracle de Cana ?</label><input id="q8"></div>

<button type="button" class="btn-nav" onclick="prevStep(4)">← Retour</button>
<button type="button" class="btn-nav" onclick="nextStep(4)">Dernière étape →</button>
</div>

<div class="step" id="step5">
<div class="q-block"><label>9. Apôtre collecteur d'impôts ?</label><input id="q9"></div>
<div class="q-block"><label>10. Qui a trahi Jésus ?</label><input id="q10"></div>

<button type="button" class="btn-nav" onclick="prevStep(5)">← Retour</button>
<button type="submit" class="btn-nav">Valider</button>
</div>

</form>

<div id="res-summary"></div>

</div>

<script>
const _supabase = supabase.createClient("TON_URL","TON_KEY");
emailjs.init("TON_PUBLIC_KEY");

let currentStep=0;

function nextStep(n){
currentStep=n+1;
document.getElementById('step'+n).classList.remove('active');
document.getElementById('step'+currentStep).classList.add('active');
document.getElementById('progressBar').style.width=(currentStep/5*100)+"%";
}

function prevStep(n){
currentStep=n-1;
document.getElementById('step'+n).classList.remove('active');
document.getElementById('step'+currentStep).classList.add('active');
document.getElementById('progressBar').style.width=(currentStep/5*100)+"%";
}

document.getElementById("quizForm").addEventListener("submit",async e=>{
e.preventDefault();

let score=0;
const answers={
q1:"bethleem",q2:"pierre",q3:"apocalypse",q4:"jean baptiste",
q5:"4",q6:"galilee",q7:"paul",q8:"vin",q9:"matthieu",q10:"judas"
};

for(let i=1;i<=10;i++){
let val=document.getElementById("q"+i).value.toLowerCase();
if(val.includes(answers["q"+i])) score++;
}

let p=prenom.value;
let n=nom.value;
let em=email.value;

emailjs.send("service_raxr77e","template_ue97zdi",{
prenom:p,email:em,score:score,niveau:"Quiz"
});

await _supabase.from("reponses").insert({
prenom:p,nom:n,email:em,score:score
});

res-summary.innerHTML=`<div class="score-anim">${score}/10</div>`;
});
</script>

</body>
</html>
