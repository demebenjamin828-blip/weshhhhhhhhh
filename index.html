<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Examen Nouveau Testament üìñ</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root { --success:#27ae60; --error:#e74c3c; --primary:#2c3e50; }
body { font-family:'Segoe UI',sans-serif;background:#f0f2f5;display:flex;justify-content:center;padding:20px;}
.quiz-card { background:white;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.1);width:100%;max-width:600px;}
.step { display:none; }
.step.active { display:block;animation:fadeIn .5s; }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
.q-block{margin-bottom:15px;padding:15px;border-radius:10px;border:1px solid #eee;}
input{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;}
.btn-nav{width:100%;padding:15px;background:var(--primary);color:white;border:none;border-radius:8px;cursor:pointer;font-weight:bold;margin-top:10px;}
.feedback{display:none;font-size:14px;margin-top:10px;font-weight:bold;}
.is-correct{border-color:var(--success)!important;background:#f0fff4;}
.is-wrong{border-color:var(--error)!important;background:#fff5f5;}
</style>
</head>
<body>

<div class="quiz-card">
<h2 style="text-align:center;">Quiz Biblique üïäÔ∏è</h2>
<div id="res-summary" style="display:none;text-align:center;padding:15px;font-size:20px;font-weight:bold;margin-bottom:10px;border:2px solid;"></div>

<form id="quizForm">

<!-- INFOS -->
<div class="step active" id="step0">
<input type="text" id="prenom" placeholder="Pr√©nom" required><br><br>
<input type="text" id="nom" placeholder="Nom" required><br><br>
<input type="email" id="email" placeholder="Email (cl√© unique)" required>
<button type="button" class="btn-nav" onclick="nextStep(0)">Commencer</button>
</div>

<!-- QUESTIONS -->
<div class="step" id="step1">
<div class="q-block" id="block1"><label>1. Ville de naissance de J√©sus ?</label><input id="q1"><div class="feedback" id="f1"></div></div>
<div class="q-block" id="block2"><label>2. Qui a reni√© J√©sus ?</label><input id="q2"><div class="feedback" id="f2"></div></div>
<button type="button" class="btn-nav" onclick="nextStep(1)">Suivant</button>
</div>

<div class="step" id="step2">
<div class="q-block" id="block3"><label>3. Dernier livre de la Bible ?</label><input id="q3"><div class="feedback" id="f3"></div></div>
<div class="q-block" id="block4"><label>4. Qui a baptis√© J√©sus ?</label><input id="q4"><div class="feedback" id="f4"></div></div>
<button type="button" class="btn-nav" onclick="nextStep(2)">Suivant</button>
</div>

<div class="step" id="step3">
<div class="q-block" id="block5"><label>5. Nombre d'√âvangiles ?</label><input id="q5"><div class="feedback" id="f5"></div></div>
<div class="q-block" id="block6"><label>6. Mer o√π J√©sus a march√© ?</label><input id="q6"><div class="feedback" id="f6"></div></div>
<button type="button" class="btn-nav" onclick="nextStep(3)">Suivant</button>
</div>

<div class="step" id="step4">
<div class="q-block" id="block7"><label>7. Auteur principal des √âp√Ætres ?</label><input id="q7"><div class="feedback" id="f7"></div></div>
<div class="q-block" id="block8"><label>8. Miracle de Cana ?</label><input id="q8"><div class="feedback" id="f8"></div></div>
<button type="button" class="btn-nav" onclick="nextStep(4)">Suivant</button>
</div>

<div class="step" id="step5">
<div class="q-block" id="block9"><label>9. Ap√¥tre collecteur d'imp√¥ts ?</label><input id="q9"><div class="feedback" id="f9"></div></div>
<div class="q-block" id="block10"><label>10. Qui a trahi J√©sus ?</label><input id="q10"><div class="feedback" id="f10"></div></div>
<button type="submit" class="btn-nav" style="background:var(--success);">Valider ‚úÖ</button>
</div>

</form>
<button onclick="location.reload()" id="btnReset" class="btn-nav" style="display:none;background:#7f8c8d;">Recommencer</button>
</div>

<script>
const _supabase = supabase.createClient(
  'https://inrcrtyvbgjrrccpzxlk.supabase.co',
  'sb_publishable_tEVOnHljw_fz5UC_cEG9pA_9xglC1VK'
);

const ANSWERS = {
  q1:["bethl√©em","bethleem"],
  q2:["pierre"],
  q3:["apocalypse"],
  q4:["jean baptiste"],
  q5:["4"],
  q6:["galil√©e","galilee"],
  q7:["paul"],
  q8:["vin","eau en vin"],
  q9:["matthieu"],
  q10:["judas"]
};

// Fonction pour normaliser et comparer tol√©ramment
function normalizeText(text){
  return text
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g,"")  // retire les accents
    .trim();
}

function nextStep(n){
  document.getElementById('step'+n).classList.remove('active');
  document.getElementById('step'+(n+1)).classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
}

document.getElementById('quizForm').addEventListener('submit', async e => {
  e.preventDefault();
  let score = 0;

  // ‚úÖ correction sur 10 questions
  for(let i=1;i<=10;i++){
    const val = normalizeText(document.getElementById('q'+i).value);
    const feedback = document.getElementById('f'+i);
    feedback.style.display = "block";

    // V√©rification tol√©rante aux accents
    const correctAnswers = ANSWERS['q'+i].map(a => normalizeText(a));
    if(correctAnswers.includes(val)){
      score++;
      document.getElementById('block'+i).classList.add('is-correct');
      feedback.innerHTML = "‚úÖ Bonne r√©ponse";
    } else {
      document.getElementById('block'+i).classList.add('is-wrong');
      feedback.innerHTML = "‚ùå R√©ponse : "+ANSWERS['q'+i][0];
    }
  }

  // ‚úÖ r√©cup√©ration des infos utilisateur
  const prenom = document.getElementById('prenom').value.trim();
  const nom = document.getElementById('nom').value.trim();
  const email = document.getElementById('email').value.trim();

  // ‚úÖ sauvegarde dans Supabase
  const { data, error } = await _supabase.from('reponses').upsert({
    email: email,
    prenom: prenom,
    nom: nom,
    score: score
  }, { onConflict: 'email' });

  if(error){
    console.log("Erreur Supabase :", error);
    alert("Erreur lors de l'enregistrement, regarde la console.");
  } else {
    console.log("Donn√©es enregistr√©es :", data);
  }

  document.getElementById('res-summary').style.display = "block";
  document.getElementById('res-summary').innerHTML = "SCORE : "+score+" / 10";
  document.getElementById('btnReset').style.display = "block";
});
</script>

</body>
</html>
