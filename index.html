<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Examen Nouveau Testament üìñ</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Supabase + EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<style>
body{
  background:linear-gradient(135deg,#f3fbf6,#d4efdf);
}

.card{
  border-radius:20px;
}

.step{display:none;}
.step.active{display:block;}

.option-btn.selected{
  background:#198754 !important;
  color:white !important;
}

.timer-danger{
  color:red;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="container py-5">
<div class="row justify-content-center">
<div class="col-lg-7">

<div class="card shadow-lg">
<div class="card-body p-4">

<h2 class="text-center text-success fw-bold mb-4">Quiz Biblique üïäÔ∏è</h2>

<!-- Progress -->
<div class="progress mb-4" style="height:20px;">
<div class="progress-bar bg-success" id="progressBar" style="width:0%"></div>
</div>

<div id="timer" class="text-center text-success fw-bold mb-3" style="display:none;">
‚è±Ô∏è Temps restant : 02:00
</div>

<form id="quizForm">

<!-- ETAPE 0 -->
<div class="step active" id="step0">

<div class="mb-3">
<label class="form-label">Pr√©nom</label>
<input type="text" id="prenom" class="form-control">
</div>

<div class="mb-3">
<label class="form-label">Nom</label>
<input type="text" id="nom" class="form-control">
</div>

<div class="mb-3">
<label class="form-label">Email</label>
<input type="email" id="email" class="form-control">
</div>

<label class="fw-bold">Choisissez votre niveau :</label>

<div class="d-flex gap-3 mt-2">
<button type="button" class="btn btn-outline-success w-100"
onclick="setLevel('Interm√©diaire',this)">Interm√©diaire</button>

<button type="button" class="btn btn-outline-danger w-100"
onclick="setLevel('Difficile',this)">Difficile</button>
</div>

<button type="button" class="btn btn-success w-100 mt-4"
onclick="startQuiz()">Commencer üöÄ</button>

</div>

<!-- QUESTIONS -->
<div class="step" id="step1"></div>
<div class="step" id="step2"></div>
<div class="step" id="step3"></div>
<div class="step" id="step4"></div>
<div class="step" id="step5"></div>

</form>

<div id="res-summary" class="text-center mt-4"></div>

<button onclick="location.reload()" id="btnReset"
class="btn btn-secondary w-100 mt-3" style="display:none;">
Recommencer
</button>

</div>
</div>

</div>
</div>
</div>

<script>
// ================= CONFIG =================
const _supabase = supabase.createClient('https://inrcrtyvbgjrrccpzxlk.supabase.co','sb_publishable_tEVOnHljw_fz5UC_cEG9pA_9xglC1VK');
emailjs.init("ulU_NSZFdTj6ZZV8T");

// ================= QUESTIONS =================
const QUESTIONS = [
"Ville de naissance de J√©sus ?",
"Qui a reni√© J√©sus ?",
"Dernier livre de la Bible ?",
"Qui a baptis√© J√©sus ?",
"Nombre d'√âvangiles ?",
"Mer o√π J√©sus a march√© ?",
"Auteur principal des √âp√Ætres ?",
"Miracle de Cana ?",
"Ap√¥tre collecteur d'imp√¥ts ?",
"Qui a trahi J√©sus ?"
];

const ANSWERS = ["bethleem","pierre","apocalypse","jean baptiste","4","galilee","paul","vin","matthieu","judas"];

let currentStep=0;
let score=0;
let selectedNiveau="";
let timeLeft=120;
let timerInterval;

// ================= NIVEAU =================
function setLevel(niveau,btn){
selectedNiveau=niveau;
document.querySelectorAll('#step0 button').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
}

// ================= DEMARRAGE =================
function startQuiz(){

if(!prenom.value || !selectedNiveau){
alert("Remplissez vos informations !");
return;
}

generateQuestions();
nextStep(0);
}

// ================= GENERER QUESTIONS =================
function generateQuestions(){

let index=0;

for(let s=1;s<=5;s++){
let html="";

for(let i=0;i<2;i++){
html+=`
<div class="mb-3">
<label class="form-label">${index+1}. ${QUESTIONS[index]}</label>
<input class="form-control" id="q${index}">
</div>`;
index++;
}

html+=`
<button type="button" class="btn btn-success w-100"
onclick="nextStep(${s})">Suivant</button>`;

if(s>1){
html+=`<button type="button" class="btn btn-secondary w-100 mt-2"
onclick="prevStep(${s})">Retour</button>`;
}

document.getElementById("step"+s).innerHTML=html;
}
}

// ================= TIMER =================
function startTimer(){
document.getElementById('timer').style.display="block";

timerInterval=setInterval(()=>{
timeLeft--;
timer.innerText="‚è±Ô∏è Temps restant : "+timeLeft+"s";

if(timeLeft<=0){
clearInterval(timerInterval);
submitQuiz();
}
},1000);
}

// ================= NAVIGATION =================
function nextStep(n){
document.getElementById("step"+n).classList.remove("active");
currentStep=n+1;
document.getElementById("step"+currentStep).classList.add("active");

progressBar.style.width=(currentStep/5*100)+"%";

if(currentStep===1)startTimer();
}

function prevStep(n){
document.getElementById("step"+n).classList.remove("active");
currentStep=n-1;
document.getElementById("step"+currentStep).classList.add("active");
}

// ================= CORRECTION =================
function submitQuiz(){

clearInterval(timerInterval);
score=0;

for(let i=0;i<10;i++){
const val=document.getElementById("q"+i).value.toLowerCase();
if(val.includes(ANSWERS[i]))score++;
}

res-summary.innerHTML=`<h3 class="text-success">${score}/10</h3>`;
btnReset.style.display="block";

// sauvegarde supabase
_supabase.from('reponses').insert({
prenom:prenom.value,
nom:nom.value,
email:email.value,
score:score,
niveau:selectedNiveau
});
}

quizForm.addEventListener("submit",e=>{
e.preventDefault();
submitQuiz();
});
</script>

</body>
</html>
