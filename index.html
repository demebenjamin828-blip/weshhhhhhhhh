<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Nouveau Testament üìñ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --success:#27ae60; --error:#e74c3c; --primary:#2c3e50; }
        body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f0f2f5; display:flex; justify-content:center; padding:20px; }
        .quiz-card { background:white; padding:30px; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.1); width:100%; max-width:600px; }
        .step { display:none; }
        .step.active { display:block; animation:fadeIn .5s; }
        @keyframes fadeIn { from{opacity:0} to{opacity:1} }
        .q-block { margin-bottom:15px; padding:15px; border-radius:10px; border:1px solid #eee; transition: 0.3s; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input { width:100%; padding:12px; border:2px solid #ddd; border-radius:8px; box-sizing: border-box; }
        .btn-nav { width:100%; padding:15px; background:var(--primary); color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold; margin-top:10px; }
        .btn-nav:hover { opacity: 0.9; }
        .feedback { display:none; font-size:14px; margin-top:10px; font-weight:bold; }
        .is-correct { border-color:var(--success)!important; background:#f0fff4; }
        .is-wrong { border-color:var(--error)!important; background:#fff5f5; }
        #res-summary { text-align:center; padding:15px; font-size:24px; font-weight:bold; margin-bottom:20px; border-radius:10px; }
    </style>
</head>
<body>

<div class="quiz-card">
    <h2 style="text-align:center;">Quiz Biblique üïäÔ∏è</h2>
    
    <div id="res-summary" style="display:none;"></div>

    <form id="quizForm">
        <div class="step active" id="step0">
            <p>Veuillez remplir vos informations pour commencer :</p>
            <input type="text" id="prenom" placeholder="Pr√©nom" required><br><br>
            <input type="text" id="nom" placeholder="Nom" required><br><br>
            <input type="email" id="email" placeholder="Email (votre identifiant unique)" required>
            <button type="button" class="btn-nav" onclick="verifyAndNext(0)">Commencer le Quiz</button>
        </div>

        <div class="step" id="step1">
            <div class="q-block" id="block1"><label>1. Ville de naissance de J√©sus ?</label><input id="q1"></div>
            <div class="q-block" id="block2"><label>2. Qui a reni√© J√©sus ?</label><input id="q2"></div>
            <button type="button" class="btn-nav" onclick="nextStep(1)">Suivant</button>
        </div>

        <div class="step" id="step2">
            <div class="q-block" id="block3"><label>3. Dernier livre de la Bible ?</label><input id="q3"></div>
            <div class="q-block" id="block4"><label>4. Qui a baptis√© J√©sus ?</label><input id="q4"></div>
            <button type="button" class="btn-nav" onclick="nextStep(2)">Suivant</button>
        </div>

        <div class="step" id="step3">
            <div class="q-block" id="block5"><label>5. Nombre d'√âvangiles ?</label><input id="q5" type="number"></div>
            <div class="q-block" id="block6"><label>6. Mer o√π J√©sus a march√© ?</label><input id="q6"></div>
            <button type="button" class="btn-nav" onclick="nextStep(3)">Suivant</button>
        </div>

        <div class="step" id="step4">
            <div class="q-block" id="block7"><label>7. Auteur principal des √âp√Ætres ?</label><input id="q7"></div>
            <div class="q-block" id="block8"><label>8. Quel est le premier miracle de J√©sus √† Cana ?</label><input id="q8" placeholder="ex: l'eau en..."></div>
            <button type="button" class="btn-nav" onclick="nextStep(4)">Suivant</button>
        </div>

        <div class="step" id="step5">
            <div class="q-block" id="block9"><label>9. Quel Ap√¥tre √©tait collecteur d'imp√¥ts ?</label><input id="q9"></div>
            <div class="q-block" id="block10"><label>10. Qui a trahi J√©sus ?</label><input id="q10"></div>
            <button type="submit" class="btn-nav" style="background:var(--success);">Terminer et voir mon score ‚úÖ</button>
        </div>
    </form>

    <button onclick="location.reload()" id="btnReset" class="btn-nav" style="display:none; background:#7f8c8d;">Recommencer le test</button>
</div>

<script>
// Initialisation Supabase (V√©rifiez bien vos cl√©s)
const _supabase = supabase.createClient('https://inrcrtyvbgjrrccpzxlk.supabase.co','sb_publishable_tEVOnHljw_fz5UC_cEG9pA_9xglC1VK');

const ANSWERS = {
    q1:["bethl√©em","bethleem"],
    q2:["pierre","saint pierre"],
    q3:["apocalypse"],
    q4:["jean baptiste","jean-baptiste"],
    q5:["4","quatre"],
    q6:["galil√©e","galilee","mer de galil√©e"],
    q7:["paul","saint paul"],
    q8:["vin","eau en vin","transformation de l'eau en vin"],
    q9:["matthieu","saint matthieu"],
    q10:["judas","judas iscariote"]
};

// Fonction pour s'assurer que les infos sont saisies
function verifyAndNext(n) {
    if(document.getElementById('prenom').value && document.getElementById('nom').value && document.getElementById('email').value) {
        nextStep(n);
    } else {
        alert("Veuillez remplir tous les champs d'identification.");
    }
}

function nextStep(n){
    document.getElementById('step'+n).classList.remove('active');
    document.getElementById('step'+(n+1)).classList.add('active');
    window.scrollTo({top:0, behavior:'smooth'});
}

document.getElementById('quizForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    let score = 0;
    const totalQuestions = 10;

    // Calcul du score et Feedback visuel
    for(let i=1; i<=totalQuestions; i++){
        const inputField = document.getElementById('q'+i);
        const val = inputField.value.toLowerCase().trim();
        const block = document.getElementById('block'+i);
        
        // Cr√©ation ou r√©cup√©ration du div feedback
        let feedback = document.getElementById('f'+i);
        if(!feedback) {
            feedback = document.createElement('div');
            feedback.id = 'f'+i;
            feedback.className = 'feedback';
            block.appendChild(feedback);
        }
        feedback.style.display = "block";

        if(ANSWERS['q'+i].includes(val)){
            score++;
            block.classList.add('is-correct');
            feedback.innerHTML = "‚úÖ Bonne r√©ponse";
            feedback.style.color = "var(--success)";
        } else {
            block.classList.add('is-wrong');
            feedback.innerHTML = "‚ùå R√©ponse attendue : " + ANSWERS['q'+i][0];
            feedback.style.color = "var(--error)";
        }
    }

    // Affichage du score final
    const summary = document.getElementById('res-summary');
    summary.style.display = "block";
    summary.innerHTML = `SCORE FINAL : ${score} / ${totalQuestions}`;
    summary.style.backgroundColor = score >= 5 ? "#d4edda" : "#f8d7da";
    summary.style.color = score >= 5 ? "#155724" : "#721c24";
    summary.style.border = "1px solid";

    // D√©sactiver les inputs et cacher le bouton de soumission
    document.querySelectorAll('input').forEach(el => el.disabled = true);
    document.querySelector('button[type="submit"]').style.display = "none";
    document.getElementById('btnReset').style.display = "block";

    // Sauvegarde dans Supabase
    try {
        const { error } = await _supabase.from('reponses').upsert({
            email: document.getElementById('email').value,
            prenom: document.getElementById('prenom').value,
            nom: document.getElementById('nom').value,
            score: score,
            updated_at: new Date()
        }, { onConflict: 'email' });
        
        if(error) throw error;
        console.log("Donn√©es sauvegard√©es !");
    } catch (err) {
        console.error("Erreur Supabase:", err.message);
    }
});
</script>
</body>
</html>
